<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polinomio de Newton - Métodos Numéricos</title>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'custom-blue': '#242A38',
                        'custom-red': '#E94560',
                        'custom-gray-bg': '#F3F4F6',
                        'sidebar-bg': '#FFFFFF',
                        'sidebar-text': '#4B5563',
                        'sidebar-hover-bg': '#FEF2F2', // Accent color for sidebar hover
                    }
                }
            }
        }
    </script>
    <!-- Configuración de MathJax -->
    <script>
        window.MathJax = {
            tex: {
                packages: {'[+]': ['input/mml', 'output/chtml']}
            },
            chtml: {
                matchFontHeight: false
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Pyodide y Chart.js -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        @keyframes animatedRainbowBorder {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        .animate-rainbow-border::before {
            content: ''; position: absolute; z-index: -1; top: -2px; left: -2px; right: -2px; bottom: -2px;
            border-radius: 9999px;
            background: linear-gradient(90deg, #ff0000, #ffff00, #00ff00, #00ffff, #007bff, #8a2be2, #ff00ff, #ff0000);
            background-size: 200% 100%;
            animation: animatedRainbowBorder 3s linear infinite;
        }
        .animate-rainbow-border { position: relative; z-index: 0; }

        /* Styles for fullscreen code output - Polinomio Newton */
        .pn-output-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9990 !important;
            background-color: #111827 !important; /* bg-gray-900 */
            padding: 20px !important;
            margin: 0 !important;
            border-radius: 0 !important;
            overflow-y: auto !important;
            max-height: 100vh !important;
        }
        .pn-body-fullscreen-active {
            overflow: hidden !important;
        }
        .pn-output-controls-container-fixed {
            position: fixed !important;
            top: 15px !important;
            right: 15px !important;
            z-index: 9999 !important;
            display: flex !important;
            align-items: center !important;
            gap: 0.25rem !important; /* space-x-1 */
        }

        /* Flash animations for font buttons - Polinomio Newton */
        .pn-font-button-flash-red {
            animation: pn-flash-red 0.4s ease-out;
        }
        @keyframes pn-flash-red {
            0% { background-color: #EF4444; } /* red-500 */
            100% { background-color: #374151; } /* gray-700, original button color */
        }
        .pn-font-button-flash-blue {
            animation: pn-flash-blue 0.4s ease-out;
        }
        @keyframes pn-flash-blue {
            0% { background-color: #3B82F6; } /* blue-500 */
            100% { background-color: #374151; } /* gray-700, original button color */
        }
        /* Table styling */
        .diff-table {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .diff-table th, .diff-table td {
            border: 1px solid #e2e8f0; /* Tailwind gray-300 */
            padding: 0.5rem 0.75rem;
            text-align: center;
        }
        .diff-table th {
            background-color: #f7fafc; /* Tailwind gray-100 */
            font-weight: 600;
        }
        .diff-table em { font-style: italic; font-weight: bold; }
        .diff-table td:first-child { text-align: left; }
    </style>
</head>
<body class="bg-custom-gray-bg text-gray-700 font-sans antialiased">
    <div id="app">
        <header class="bg-custom-blue text-white shadow-md">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <h1 class="text-xl font-semibold"><a href="../index.html" class="hover:text-gray-300">Métodos Numéricos</a></h1>
                <nav><a href="../index.html#method-cards-container" class="text-sm px-4 py-2 rounded-md hover:bg-gray-700 transition-colors duration-150">Volver a Métodos</a></nav>
            </div>
        </header>

        <div class="container mx-auto mt-8 mb-8 flex flex-col lg:flex-row lg:space-x-8 px-4">
            <left-sidebar></left-sidebar>
            <main class="w-full flex-1 min-w-0 bg-white shadow-xl rounded-lg p-6 md:p-8 order-2 mb-6 lg:mb-0">
                <article class="method-content">
                    <h2 class="text-3xl font-bold mb-6 text-gray-800 border-b border-gray-200 pb-4">Polinomio de Interpolación de Newton</h2>

                    <section id="teoria" class="mb-10 scroll-mt-24">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Fundamento Teórico</h3>
                        <p class="text-gray-600 leading-relaxed mb-4">
                            El polinomio de interpolación de Newton es otra forma de construir un polinomio único de grado \(n\) que pasa a través de \(n+1\) puntos de datos dados: \((x_0, y_0)\), \((x_1, y_1)\), ..., \((x_n, y_n)\). Utiliza el concepto de diferencias divididas finitas.
                        </p>
                        <p class="text-gray-600 leading-relaxed mb-4">
                            La forma general del polinomio de Newton de grado \(n\) es:
                        </p>
                        <p style="text-align:center; overflow-x: auto; white-space: nowrap;" class="mb-4 tex2jax_process">
                            \(P_n(x) = f[x_0] + f[x_0, x_1](x - x_0) + f[x_0, x_1, x_2](x - x_0)(x - x_1) + \dots + f[x_0, \dots, x_n](x - x_0)\dots(x - x_{n-1})\)
                        </p>
                        <p class="text-gray-600 leading-relaxed mb-2">Donde los coeficientes \(f[x_0]\), \(f[x_0, x_1]\), etc., son las diferencias divididas finitas. Se definen recursivamente:</p>
                        <ul class="list-disc list-inside space-y-2 pl-4 text-gray-600 mb-4 tex2jax_process">
                            <li><strong>Diferencia dividida de orden cero:</strong> \(f[x_i] = y_i\)</li>
                            <li><strong>Diferencia dividida de primer orden:</strong> \(f[x_i, x_j] = \frac{f[x_j] - f[x_i]}{x_j - x_i}\)</li>
                            <li><strong>Diferencia dividida de segundo orden:</strong> \(f[x_i, x_j, x_k] = \frac{f[x_j, x_k] - f[x_i, x_j]}{x_k - x_i}\)</li>
                            <li>Y así sucesivamente. En general:
                                <p style="text-align:center;" class="mt-2">
                                \(f[x_i, x_{i+1}, \dots, x_j] = \frac{f[x_{i+1}, \dots, x_j] - f[x_i, \dots, x_{j-1}]}{x_j - x_i}\)
                                </p>
                            </li>
                        </ul>
                        <p class="text-gray-600 leading-relaxed mb-4">
                            Una ventaja del polinomio de Newton es que si se añade un nuevo punto de datos, los coeficientes previamente calculados no cambian; simplemente se añade un nuevo término al polinomio. Esto es diferente al método de Lagrange, donde todos los polinomios base deben recalcularse.
                        </p>
                    </section>

                    <section id="algoritmo" class="mb-10 scroll-mt-24">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Pasos del Algoritmo</h3>
                        <ol class="list-decimal list-inside space-y-3 pl-4 text-gray-600 leading-relaxed tex2jax_process">
                            <li>Dados \(n+1\) puntos \((x_0, y_0)\), ..., \((x_n, y_n)\).</li>
                            <li>
                                <strong>Construir la tabla de diferencias divididas:</strong>
                                <ul class="list-disc list-inside space-y-1 pl-6 mt-2">
                                    <li>La primera columna son los valores de \(y_i\) (o \(f[x_i]\)).</li>
                                    <li>La segunda columna contiene las primeras diferencias divididas \(f[x_i, x_{i+1}]\).</li>
                                    <li>La tercera columna contiene las segundas diferencias divididas \(f[x_i, x_{i+1}, x_{i+2}]\), y así sucesivamente.</li>
                                    <li>Los coeficientes del polinomio de Newton son los valores de la diagonal superior de esta tabla: \(f[x_0], f[x_0, x_1], \dots, f[x_0, \dots, x_n]\).</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Formar el polinomio de Newton:</strong>
                                <p style="text-align:center; overflow-x: auto; white-space: nowrap;" class="mt-2 mb-2">
                                    \(P_n(x) = c_0 + c_1(x - x_0) + c_2(x - x_0)(x - x_1) + \dots + c_n(x - x_0)\dots(x - x_{n-1})\)
                                </p>
                                <p>Donde \(c_k = f[x_0, \dots, x_k]\).</p>
                            </li>
                            <li>Evaluar \(P_n(x)\) para el valor deseado de \(x\).</li>
                        </ol>
                    </section>

                    <section id="ejemplo" class="mb-10 scroll-mt-24">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Ejemplo Paso a Paso</h3>
                        <p class="text-gray-600 leading-relaxed mb-3 tex2jax_process">Interpolar usando el polinomio de Newton para los puntos: \((x_0=1, y_0=0)\), \((x_1=4, y_1=1.386)\), \((x_2=6, y_2=1.792)\). Estimar \(y\) para \(x=2\).</p>
                        <p class="text-gray-600 leading-relaxed mb-3">1. <strong>Tabla de Diferencias Divididas:</strong></p>
                        <div class="overflow-x-auto">
                            <table class="diff-table">
                                <thead>
                                    <tr><th>\(x_i\)</th><th>\(y_i = f[x_i]\)</th><th>\(f[x_i, x_{i+1}]\)</th><th>\(f[x_i, x_{i+1}, x_{i+2}]\)</th></tr>
                                </thead>
                                <tbody>
                                <tr><td>\(x_0=1\)</td><td><em>0</em></td><td></td><td></td></tr>
                                <tr><td></td><td></td><td>\(f[x_0,x_1] = (1.386-0)/(4-1) = 1.386/3 = \)<em>0.462</em></td><td></td></tr>
                                <tr><td>\(x_1=4\)</td><td>1.386</td><td></td><td>\(f[x_0,x_1,x_2] = (0.203-0.462)/(6-1) = -0.259/5 = \)<em>-0.0518</em></td></tr>
                                <tr><td></td><td></td><td>\(f[x_1,x_2] = (1.792-1.386)/(6-4) = 0.406/2 = 0.203\)</td><td></td></tr>
                                <tr><td>\(x_2=6\)</td><td>1.792</td><td></td><td></td></tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="text-gray-600 leading-relaxed my-3 tex2jax_process">Los coeficientes son: \(c_0=0\), \(c_1=0.462\), \(c_2=-0.0518\).</p>
                        <p class="text-gray-600 leading-relaxed mb-1">2. <strong>Formar el Polinomio \(P_2(x)\):</strong></p>
                        <p class="text-gray-600 leading-relaxed mb-1 tex2jax_process">\(P_2(x) = c_0 + c_1(x - x_0) + c_2(x - x_0)(x - x_1)\)</p>
                        <p class="text-gray-600 leading-relaxed mb-3 tex2jax_process">\(P_2(x) = 0 + 0.462(x - 1) - 0.0518(x - 1)(x - 4)\)</p>
                        <p class="text-gray-600 leading-relaxed mb-1">3. <strong>Evaluar para \(x=2\):</strong></p>
                        <p class="text-gray-600 leading-relaxed mb-1 tex2jax_process">\(P_2(2) = 0.462(2 - 1) - 0.0518(2 - 1)(2 - 4)\)</p>
                        <p class="text-gray-600 leading-relaxed mb-1 tex2jax_process">\(P_2(2) = 0.462(1) - 0.0518(1)(-2)\)</p>
                        <p class="text-gray-600 leading-relaxed mb-1 tex2jax_process">\(P_2(2) = 0.462 + 0.1036 = 0.5656\)</p>
                        <p class="text-gray-600 leading-relaxed mb-3 tex2jax_process">El valor interpolado de \(y\) en \(x=2\) es \(0.5656\). (Si los puntos fueran de \(\ln(x)\), \(\ln(2) \approx 0.693\)).</p>
                    </section>

                    <section id="codigo" class="mb-10 scroll-mt-24">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Código de Implementación (Python) - Ejecutable</h3>
                        <div class="code-editor-container bg-gray-50 p-4 rounded-lg shadow-inner">
                            <textarea id="polinomio-newton-code-input" class="code-input w-full h-96 p-3 border border-gray-300 rounded-md font-mono text-sm" style="resize: vertical;">
import numpy as np

def divided_differences_table_html(x_nodes, y_nodes):
    """Calcula la tabla de diferencias divididas y retorna HTML para la tabla y los coeficientes."""
    n = len(x_nodes)
    if n != len(y_nodes):
        raise ValueError("x_nodes y y_nodes deben tener la misma longitud.")
    
    table_data = np.zeros((n, n))
    table_data[:, 0] = y_nodes # Primera columna son los y_i

    for j in range(1, n): # Columnas de diferencias
        for i in range(n - j): # Filas en esa columna
            table_data[i, j] = (table_data[i+1, j-1] - table_data[i, j-1]) / (x_nodes[i+j] - x_nodes[i])
            
    coefficients = table_data[0, :] # Diagonal superior (f[x0], f[x0,x1], ...)

    # Generar HTML para la tabla de diferencias divididas
    html_table = '<h4 style="text-align:center; margin-bottom:5px;">Tabla de Diferencias Divididas:</h4>'
    html_table += '<table border="1" style="width:auto; margin-left:auto; margin-right:auto; border-collapse: collapse; font-size: 0.85em;"><thead><tr>'
    html_table += '<th style="padding: 4px; text-align:center;">x_i</th>'
    html_table += '<th style="padding: 4px; text-align:center;">y_i = f[x_i]</th>'
    for k in range(1, n):
        html_table += f'<th style="padding: 4px; text-align:center;">{k}ª Dif.Div.</th>'
    html_table += '</tr></thead><tbody>'

    # Llenar la tabla HTML
    # Esto es una representación simplificada, una tabla completa requeriría más lógica para alternar celdas vacías
    # Aquí mostramos la tabla triangular superior que Pyodide almacena
    for i in range(n):
        html_table += '<tr>'
        html_table += f'<td style="padding: 4px; text-align:center;">{x_nodes[i]}</td>'
        for j in range(n - i):
            if j == 0: # y_values
                 html_table += f'<td style="padding: 4px; text-align:right; padding-right:5px;">{table_data[i,j]:.4f}</td>'
            elif table_data[i,j] != 0 : # Solo mostrar valores calculados
                 html_table += f'<td style="padding: 4px; text-align:right; padding-right:5px;">{table_data[i,j]:.4f}</td>'
            else: # Rellenar celdas no usadas por la diagonal
                if n-i-1 < j : # Si estamos más allá de la diagonal para esa fila
                    html_table += '<td></td>'

        # Rellenar las celdas restantes para filas más cortas en la representación triangular
        for k_fill in range(i):
             html_table += '<td></td>'
        html_table += '</tr>'

    html_table += '</tbody></table>'
    
    html_coeffs = '<p style="text-align:center; margin-top:10px;"><strong>Coeficientes del Polinomio (c_k):</strong> '
    html_coeffs += ", ".join([f"{c:.4f}" for c in coefficients]) + '</p>'
    
    return html_table, html_coeffs, coefficients, table_data # Devolver también table_data para el log

def newton_polynomial_evaluation(x_nodes, coefficients, x_eval):
    """Evalúa el polinomio de Newton en el punto x_eval."""
    n_coeffs = len(coefficients)
    result = coefficients[0]
    term_product = 1.0

    for i in range(1, n_coeffs):
        term_product *= (x_eval - x_nodes[i-1])
        result += coefficients[i] * term_product
        
    return result

# --- Parámetros Ejemplo ---
if __name__ == "__main__":
    output_buffer_pn = []
    
    # Puntos del ejemplo en la página
    x_pts_pn = np.array([1, 4, 6])
    y_pts_pn = np.array([0, 1.386, 1.792])
    x_to_interpolate_pn = 2

    # Puntos para el segundo ejemplo
    # x_pts_pn = np.array([0, 1, 2, 4])
    # y_pts_pn = np.array([1, 1, 2, 5])
    # x_to_interpolate_pn = 3
    
    initial_info_html_pn = '<div style="text-align: center; font-weight: bold; margin-bottom:15px; font-size:1.1em;">POLINOMIO DE INTERPOLACIÓN DE NEWTON</div>'
    initial_info_html_pn += f'<div style="text-align: center; margin-bottom:5px;">Puntos X: {x_pts_pn.tolist()}</div>'
    initial_info_html_pn += f'<div style="text-align: center; margin-bottom:5px;">Puntos Y: {y_pts_pn.tolist()}</div>'
    initial_info_html_pn += f'<div style="text-align: center; margin-bottom:15px;">Valor de X a interpolar: {x_to_interpolate_pn}</div>'
    output_buffer_pn.append(initial_info_html_pn)

    # Calcular tabla de diferencias divididas y coeficientes
    table_html_pn, coeffs_html_pn, coeffs_calc_pn, full_table_data_pn = divided_differences_table_html(x_pts_pn, y_pts_pn)
    output_buffer_pn.append(table_html_pn)
    output_buffer_pn.append(coeffs_html_pn)
    
    # Evaluar el polinomio
    y_interpolated_pn = newton_polynomial_evaluation(x_pts_pn, coeffs_calc_pn, x_to_interpolate_pn)
    
    result_html_pn = f'<div style="text-align: center; color: green; margin-top:15px; font-weight:bold;">Resultado de la interpolación:</div>'
    result_html_pn += f'<p style="text-align:center;">P({x_to_interpolate_pn}) = {y_interpolated_pn:.4f}</p>'
    output_buffer_pn.append(result_html_pn)

    # Para Pyodide, la variable global 'pyodide_html_output_pn' contendrá el resultado.
    # También se poblará 'js_iteration_data_pn'.
    try:
        # Guardar datos de iteraciones/cálculo para la gráfica
        global js_iteration_data_pn # Pyodide specific
        js_data_container_pn = js_iteration_data_pn
        js_data_container_pn.clear() 
        js_data_container_pn.append({
            'x_nodes': x_pts_pn.tolist(),
            'y_nodes': y_pts_pn.tolist(),
            'coeffs': coeffs_calc_pn.tolist(),
            'x_interpolated': x_to_interpolate_pn,
            'y_interpolated': y_interpolated_pn,
            'full_table_for_log': full_table_data_pn.tolist() # para depuración o visualización avanzada si se quiere
        })
        
        # Guardar salida HTML completa
        global pyodide_html_output_pn
        pyodide_html_output_pn = "\\n".join(output_buffer_pn)
    except NameError:
        print("Ejecutando localmente (Polinomio Newton), imprimiendo HTML generado:")
        print("\\n".join(output_buffer_pn))

                            </textarea>
                            <button id="run-polinomio-newton-code-button" class="run-button mt-4 px-5 py-2.5 bg-custom-red text-white rounded-md hover:bg-red-700">Ejecutar Código</button>

                            <div class="relative">
                                <div id="pn-output-controls-container" class="absolute top-0 right-0 z-10 flex items-center space-x-1 transition-all duration-500 ease-out">
                                    <button id="pn-decrease-font-button" title="Disminuir fuente" class="p-1.5 bg-gray-700 text-white rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 text-xs font-semibold flex items-center justify-center" style="min-width: 30px; display: none;">
                                        aa
                                    </button>
                                    <button id="pn-increase-font-button" title="Aumentar fuente" class="p-1.5 bg-gray-700 text-white rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 text-xs font-semibold flex items-center justify-center" style="min-width: 30px; display: none;">
                                        AA
                                    </button>
                                    <button id="pn-fullscreen-output-button" title="Ver en pantalla completa" class="p-1.5 bg-gray-700 text-white rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 text-xs">
                                        <!-- SVG will be injected by JS -->
                                    </button>
                                </div>
                                <h4 class="mt-5 mb-2 text-lg font-semibold text-gray-700">Salida:</h4>
                                <pre id="polinomio-newton-code-output" class="code-output bg-gray-900 text-white p-4 pt-10 rounded-md min-h-[100px] whitespace-pre-wrap transition-all duration-500 ease-out text-xs leading-relaxed max-h-96 overflow-y-auto font-mono">Presiona "Ejecutar Código" para ver la salida.</pre>
                            </div>
                        </div>
                    </section>

                    <section id="graficas" class="mb-10 scroll-mt-24">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Gráficas Interactivas</h3>
                        <p class="text-gray-600 leading-relaxed mb-4">
                            La siguiente gráfica muestra los puntos de datos ingresados y el polinomio de interpolación de Newton que pasa a través de ellos. También se resalta el punto interpolado si se ha calculado.
                            Puede modificar los puntos `x_pts_pn`, `y_pts_pn` y el valor `x_to_interpolate_pn` en el código Python y re-ejecutar para ver la gráfica actualizada.
                        </p>
                        <div class="interactive-graphics w-full h-96 bg-white p-4 rounded-lg shadow-md">
                            <canvas id="newton-polynomial-chart"></canvas>
                            <p id="chart-loading-message-pn" class="text-center text-gray-600 italic mt-2">Ejecute el código para generar los datos de la gráfica.</p>
                        </div>
                    </section>

                    <section id="videos" class="mb-10 scroll-mt-24">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Videos Explicativos</h3>
                        <div class="video-embed w-full h-96">
                            <iframe class="w-full h-full rounded-lg shadow-lg" src="https://www.youtube.com/embed/AISHH6goWUs" title="YouTube video player - Polinomio de Interpolación de Newton" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                        </div>
                    </section>

                    <section id="conclusion-metodo" class="mb-10 scroll-mt-24">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Conclusión y Aplicaciones</h3>
                        <p class="text-gray-600 leading-relaxed mb-4">
                            El polinomio de interpolación de Newton proporciona un método sistemático y eficiente para encontrar el polinomio que pasa por un conjunto de puntos dados. Su uso de diferencias divididas permite una construcción recursiva y la fácil adición de nuevos puntos de datos sin recalcular todo el trabajo anterior.
                        </p>
                        <p class="text-gray-600 leading-relaxed mb-4">
                            Es algebraicamente equivalente al polinomio de Lagrange, pero puede ser computacionalmente más eficiente para ciertas operaciones, como la evaluación del polinomio en múltiples puntos o cuando se añaden puntos progresivamente. Al igual que otros polinomios de interpolación de alto grado, puede sufrir del fenómeno de Runge si se interpola sobre un gran número de puntos equiespaciados con funciones que varían mucho.
                        </p>
                        <p class="text-gray-600 leading-relaxed mb-2 font-medium">
                            <strong>Aplicaciones:</strong>
                        </p>
                        <ul class="list-disc list-inside space-y-2 pl-4 text-gray-600 mb-4">
                            <li>Aproximación de funciones cuando se conocen varios puntos.</li>
                            <li>Cuando se necesita añadir puntos al conjunto de datos y actualizar la interpolación eficientemente.</li>
                            <li>Derivación de fórmulas de integración numérica (fórmulas de Newton-Cotes).</li>
                            <li>En análisis numérico para la estimación de funciones y sus derivadas.</li>
                        </ul>
                    </section>

                    <section id="referencias" class="mb-10 scroll-mt-24">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Referencias</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-600 leading-relaxed pl-4">
                             <li>Chapra, S. C., & Canale, R. P. (2015). <em>Numerical Methods for Engineers</em> (7th ed.). McGraw-Hill Education. (Capítulo 18, sección 18.2 para Polinomio de Newton).</li>
                             <li>Burden, R. L., & Faires, J. D. (2011). <em>Numerical Analysis</em> (9th ed.). Brooks/Cole, Cengage Learning. (Capítulo 3, sección 3.2 para Interpolación y el Polinomio de Lagrange, y 3.3 para Diferencias Divididas de Newton).</li>
                        </ul>
                    </section>

                    <section id="cuestionario" class="scroll-mt-24 mb-10">
                        <h3 class="text-2xl font-semibold mb-4 text-gray-700">Cuestionario: Polinomio de Newton</h3>
                        <form id="quiz-pn" class="space-y-6 bg-gray-50 p-6 rounded-lg shadow-inner">
                            <!-- Pregunta 1 -->
                            <div class="quiz-question space-y-2">
                                <p class="text-sm font-medium text-gray-700">1. El polinomio de interpolación de Newton utiliza principalmente:</p>
                                <fieldset class="mt-2">
                                    <legend class="sr-only">Opciones para la pregunta 1</legend>
                                    <div class="space-y-2">
                                        <label for="q1-opt1-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q1-opt1-pn" name="question-1-pn" type="radio" value="Series de Taylor." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">Series de Taylor.</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                        <label for="q1-opt2-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q1-opt2-pn" name="question-1-pn" type="radio" value="Diferencias divididas finitas." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">Diferencias divididas finitas.</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                        <label for="q1-opt3-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q1-opt3-pn" name="question-1-pn" type="radio" value="Mínimos cuadrados." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">Mínimos cuadrados.</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                    </div>
                                </fieldset>
                                <div id="question-1-pn-specific-feedback" class="specific-question-feedback mt-2 p-2.5 text-xs bg-red-50 text-red-600 border border-red-200 rounded-md" style="display: none;"></div>
                            </div>

                            <!-- Pregunta 2 -->
                            <div class="quiz-question space-y-2">
                                <p class="text-sm font-medium text-gray-700">2. Una ventaja clave del polinomio de Newton sobre el de Lagrange es:</p>
                                <fieldset class="mt-2">
                                    <legend class="sr-only">Opciones para la pregunta 2</legend>
                                    <div class="space-y-2">
                                        <label for="q2-opt1-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q2-opt1-pn" name="question-2-pn" type="radio" value="Siempre es más preciso para un mismo número de puntos." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">Siempre es más preciso para un mismo número de puntos.</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                        <label for="q2-opt2-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q2-opt2-pn" name="question-2-pn" type="radio" value="Permite añadir nuevos puntos de datos y actualizar el polinomio más fácilmente." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">Permite añadir nuevos puntos de datos y actualizar el polinomio más fácilmente.</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                        <label for="q2-opt3-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q2-opt3-pn" name="question-2-pn" type="radio" value="Solo funciona para puntos equiespaciados." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">Solo funciona para puntos equiespaciados.</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                    </div>
                                </fieldset>
                                <div id="question-2-pn-specific-feedback" class="specific-question-feedback mt-2 p-2.5 text-xs bg-red-50 text-red-600 border border-red-200 rounded-md" style="display: none;"></div>
                            </div>

                            <!-- Pregunta 3 -->
                            <div class="quiz-question space-y-2 tex2jax_process">
                                <p class="text-sm font-medium text-gray-700">3. Los coeficientes del polinomio de Newton \(P_n(x) = c_0 + c_1(x-x_0) + \dots\) corresponden a:</p>
                                <fieldset class="mt-2">
                                    <legend class="sr-only">Opciones para la pregunta 3</legend>
                                    <div class="space-y-2">
                                        <label for="q3-opt1-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q3-opt1-pn" name="question-3-pn" type="radio" value="Los valores \\(y_i\\) directamente." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">Los valores \(y_i\) directamente.</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                        <label for="q3-opt2-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q3-opt2-pn" name="question-3-pn" type="radio" value="Las derivadas de la función en \\(x_0\\)." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">Las derivadas de la función en \(x_0\).</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                        <label for="q3-opt3-pn" class="quiz-option-wrapper flex items-center p-3 w-full rounded-md border border-gray-300 hover:border-gray-400 cursor-pointer transition-all duration-150 has-[:checked]:bg-red-50 has-[:checked]:border-custom-red has-[:checked]:ring-1 has-[:checked]:ring-custom-red">
                                            <input id="q3-opt3-pn" name="question-3-pn" type="radio" value="La diagonal superior de la tabla de diferencias divididas (f[\\(x_0\\)], f[\\(x_0,x_1\\)], etc.)." class="h-4 w-4 text-custom-red border-gray-300 focus:ring-custom-red accent-custom-red">
                                            <span class="option-text ml-3 text-sm text-gray-700">La diagonal superior de la tabla de diferencias divididas (\(f[x_0]\), \(f[x_0,x_1]\), etc.).</span>
                                            <span class="feedback-icon-placeholder ml-auto pl-2"><span class="inline-block w-5 h-5"></span></span>
                                        </label>
                                    </div>
                                </fieldset>
                                <div id="question-3-pn-specific-feedback" class="specific-question-feedback mt-2 p-2.5 text-xs bg-red-50 text-red-600 border border-red-200 rounded-md" style="display: none;"></div>
                            </div>

                            <button type="submit" class="mt-6 w-full px-6 py-3 bg-custom-red text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-150">
                                Enviar Respuestas
                            </button>
                        </form>
                        <div id="quiz-feedback-pn" class="quiz-feedback-message mt-4 p-3 rounded-md text-sm" style="display: none;"></div>
                    </section>

                </article>
            </main>

            <aside class="w-full lg:w-1/4 bg-sidebar-bg shadow-xl rounded-lg p-6 self-start sticky top-8 order-3 space-y-6">
                <div class="pb-6 border-b border-gray-200">
                    <h3 class="text-base font-semibold text-gray-500 uppercase tracking-wide mb-4">Perfil</h3>
                    <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                           <svg class="w-12 h-12 text-gray-400 bg-gray-100 rounded-full p-1 ring-1 ring-gray-200" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 text-md">Estudiante Dedicado</p>
                            <p class="text-sm text-gray-500">Explorador Numérico</p>
                        </div>
                    </div>
                </div>

                <div class="pb-6 border-b border-gray-200 space-y-3">
                    <h3 class="text-base font-semibold text-gray-500 uppercase tracking-wide">Progreso en Polinomio de Newton</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-center">
                            <span id="task-read-theory-status-pn" class="task-status-icon mr-2 text-gray-400">
                                <!-- Icon placeholder -->
                            </span>
                            <span class="text-gray-600">Leer la teoría completa</span>
                        </li>
                        <li class="flex items-center">
                            <span id="task-run-code-status-pn" class="task-status-icon mr-2 text-gray-400">
                                <!-- Icon placeholder -->
                            </span>
                            <span class="text-gray-600">Ejecutar el código Python</span>
                        </li>
                        <li class="flex items-center">
                            <span id="task-quiz-attempted-status-pn" class="task-status-icon mr-2 text-gray-400">
                                <!-- Icon placeholder -->
                            </span>
                            <span class="text-gray-600">Intentar el cuestionario</span>
                        </li>
                        <li class="flex items-center">
                            <span id="task-quiz-passed-status-pn" class="task-status-icon mr-2 text-gray-400">
                                <!-- Icon placeholder -->
                            </span>
                            <span class="text-gray-600">Aprobar el cuestionario</span>
                        </li>
                    </ul>

                    <div class="flex items-center justify-between mb-1 mt-3">
                       <span class="text-xs font-medium text-custom-red">Progreso General</span>
                       <span id="right-sidebar-progress-text-pn" class="text-xs font-medium text-custom-red right-sidebar-progress-text">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div id="right-sidebar-progress-bar-pn" class="bg-custom-red h-3 rounded-full right-sidebar-progress-bar transition-width duration-500 ease-in-out" style="width: 0%"></div>
                    </div>
                    
                    <button id="completion-polinomio-newton-sidebar" class="mt-4 w-full completion-button px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 font-medium text-sm transition-colors duration-150">Marcar Todo Completado</button>
                </div>

                <div class="pb-6 border-b border-gray-200">
                    <h3 class="text-base font-semibold text-gray-500 uppercase tracking-wide mb-3">Recursos y Notas</h3>
                    <p class="text-sm text-gray-600">
                        <a href="https://archive.org/details/numerical-methods-for-engineers-7th-edit" target="_blank" rel="noopener noreferrer" class="hover:text-custom-red hover:underline">
                            Métodos Numéricos para Ingenieros 7ma Edición de Chapra (Cap. 18)
                        </a>
                    </p>
                     <img src="https://images.cdn3.buscalibre.com/fit-in/360x360/97/ff/97ffa61a8adb147e569e12c4f1f797b3.jpg" alt="Portada del libro Métodos Numéricos para Ingenieros de Chapra" class="mt-2 w-full rounded-md shadow-sm">
                </div>

                <div>
                    <h3 class="text-base font-semibold text-gray-500 uppercase tracking-wide mb-3">Siguiente Paso</h3>
                    <a href="../index.html#method-cards-container" class="group flex items-center text-sm font-medium text-custom-red hover:text-red-700 transition-colors duration-150">
                       <span>Volver a la lista de métodos</span> 
                       <svg class="w-4 h-4 ml-1 transform group-hover:translate-x-1 transition-transform duration-150" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </a>
                </div>
            </aside>

        </div>

        <footer class="bg-custom-blue text-gray-300 text-center p-6 mt-12">
            <p>&copy; 2024 Plataforma Educativa de Métodos Numéricos. <a href="../index.html" class="hover:text-white underline">Volver al inicio</a></p>
        </footer>
    </div>

    <!-- START PN SCRIPT -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- START: Fullscreen and Font Control Logic for Code Output (Adapted for PN) ---
        const fullscreenButton_PN = document.getElementById('pn-fullscreen-output-button');
        const codeOutput_PN = document.getElementById('polinomio-newton-code-output');
        const outputControlsContainer_PN = document.getElementById('pn-output-controls-container');
        const increaseFontButton_PN = document.getElementById('pn-increase-font-button');
        const decreaseFontButton_PN = document.getElementById('pn-decrease-font-button');
        let originalOutputFontSize_PN = '';
        const MIN_FONT_SIZE_PX_PN = 8;
        const MAX_FONT_SIZE_PX_PN = 28;
        const FONT_SIZE_STEP_PX_PN = 1;
        let pnCodeOutputInitialRect = null;

        if (fullscreenButton_PN) {
            fullscreenButton_PN.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9m5.25 11.25v-4.5m0 4.5h-4.5m4.5 0L15 15" />
                </svg>`;
            fullscreenButton_PN.title = "Ver en pantalla completa";
        }

        if (fullscreenButton_PN && codeOutput_PN && outputControlsContainer_PN) {
            fullscreenButton_PN.addEventListener('click', () => {
                const isFullscreen = codeOutput_PN.classList.contains('pn-output-fullscreen');
                if (isFullscreen) { // EXITING
                    outputControlsContainer_PN.style.opacity = '0';
                    if(increaseFontButton_PN) increaseFontButton_PN.style.display = 'none';
                    if(decreaseFontButton_PN) decreaseFontButton_PN.style.display = 'none';
                    if (pnCodeOutputInitialRect) {
                        const finalRect = codeOutput_PN.getBoundingClientRect();
                        const scaleX = pnCodeOutputInitialRect.width / finalRect.width;
                        const scaleY = pnCodeOutputInitialRect.height / finalRect.height;
                        const deltaX = (pnCodeOutputInitialRect.left + pnCodeOutputInitialRect.width / 2) - (finalRect.left + finalRect.width / 2);
                        const deltaY = (pnCodeOutputInitialRect.top + pnCodeOutputInitialRect.height / 2) - (finalRect.top + finalRect.height / 2);
                        codeOutput_PN.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(${scaleX}, ${scaleY})`;
                    }
                    setTimeout(() => {
                        codeOutput_PN.style.transition = 'none';
                        codeOutput_PN.classList.remove('pn-output-fullscreen');
                        document.body.classList.remove('pn-body-fullscreen-active');
                        outputControlsContainer_PN.classList.remove('pn-output-controls-container-fixed');
                        outputControlsContainer_PN.style.transition = 'none'; outputControlsContainer_PN.style.opacity = '1'; outputControlsContainer_PN.offsetHeight; outputControlsContainer_PN.style.transition = '';
                        codeOutput_PN.style.transform = '';
                        if (originalOutputFontSize_PN) codeOutput_PN.style.fontSize = originalOutputFontSize_PN;
                        codeOutput_PN.offsetHeight; codeOutput_PN.style.transition = '';
                        fullscreenButton_PN.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9m5.25 11.25v-4.5m0 4.5h-4.5m4.5 0L15 15" /></svg>`;
                        fullscreenButton_PN.title = "Ver en pantalla completa";
                        pnCodeOutputInitialRect = null;
                    }, 500);
                } else { // ENTERING
                    originalOutputFontSize_PN = window.getComputedStyle(codeOutput_PN).fontSize;
                    pnCodeOutputInitialRect = codeOutput_PN.getBoundingClientRect();
                    outputControlsContainer_PN.style.transition = 'none'; outputControlsContainer_PN.style.opacity = '0'; outputControlsContainer_PN.offsetHeight; outputControlsContainer_PN.style.transition = '';
                    if(increaseFontButton_PN) increaseFontButton_PN.style.display = 'none';
                    if(decreaseFontButton_PN) decreaseFontButton_PN.style.display = 'none';
                    codeOutput_PN.style.transition = 'none';
                    codeOutput_PN.classList.add('pn-output-fullscreen');
                    document.body.classList.add('pn-body-fullscreen-active');
                    outputControlsContainer_PN.classList.add('pn-output-controls-container-fixed');
                    const finalRect = codeOutput_PN.getBoundingClientRect();
                    const scaleX = pnCodeOutputInitialRect.width / finalRect.width;
                    const scaleY = pnCodeOutputInitialRect.height / finalRect.height;
                    const deltaX = (pnCodeOutputInitialRect.left + pnCodeOutputInitialRect.width / 2) - (finalRect.left + finalRect.width / 2);
                    const deltaY = (pnCodeOutputInitialRect.top + pnCodeOutputInitialRect.height / 2) - (finalRect.top + finalRect.height / 2);
                    codeOutput_PN.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(${scaleX}, ${scaleY})`;
                    codeOutput_PN.offsetHeight; codeOutput_PN.style.transition = ''; codeOutput_PN.style.transform = 'translate(0px, 0px) scale(1)';
                    fullscreenButton_PN.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9V4.5M15 9h4.5M15 9l5.25-5.25M15 15v4.5M15 15h4.5M15 15l5.25 5.25" /></svg>`;
                    fullscreenButton_PN.title = "Salir de pantalla completa";
                    setTimeout(() => {
                        outputControlsContainer_PN.style.opacity = '1';
                        if(increaseFontButton_PN) increaseFontButton_PN.style.display = 'flex';
                        if(decreaseFontButton_PN) decreaseFontButton_PN.style.display = 'flex';
                    }, 500);
                }
            });
        }
        if (increaseFontButton_PN && codeOutput_PN) {
            increaseFontButton_PN.addEventListener('click', (e) => {
                e.stopPropagation();
                const currentSize = parseFloat(window.getComputedStyle(codeOutput_PN).fontSize);
                if (currentSize < MAX_FONT_SIZE_PX_PN) codeOutput_PN.style.fontSize = `${Math.min(currentSize + FONT_SIZE_STEP_PX_PN, MAX_FONT_SIZE_PX_PN)}px`;
                increaseFontButton_PN.classList.add('pn-font-button-flash-blue');
                setTimeout(() => increaseFontButton_PN.classList.remove('pn-font-button-flash-blue'), 400);
            });
        }
        if (decreaseFontButton_PN && codeOutput_PN) {
            decreaseFontButton_PN.addEventListener('click', (e) => {
                e.stopPropagation();
                const currentSize = parseFloat(window.getComputedStyle(codeOutput_PN).fontSize);
                if (currentSize > MIN_FONT_SIZE_PX_PN) codeOutput_PN.style.fontSize = `${Math.max(currentSize - FONT_SIZE_STEP_PX_PN, MIN_FONT_SIZE_PX_PN)}px`;
                decreaseFontButton_PN.classList.add('pn-font-button-flash-red');
                setTimeout(() => decreaseFontButton_PN.classList.remove('pn-font-button-flash-red'), 400);
            });
        }
        // --- END: Fullscreen and Font Control Logic ---

        const PAGE_KEY_PN = 'polinomio-newton';
        const QUIZ_FORM_ID_PN = 'quiz-pn';
        const QUIZ_FEEDBACK_ID_PN = 'quiz-feedback-pn';
        const COMPLETION_BUTTON_ID_PN = 'completion-polinomio-newton-sidebar';
        const CODE_INPUT_ID_PN = 'polinomio-newton-code-input';
        const CODE_OUTPUT_ID_PN = 'polinomio-newton-code-output';
        const RUN_CODE_BUTTON_ID_PN = 'run-polinomio-newton-code-button';
        const CHART_CANVAS_ID_PN = 'newton-polynomial-chart';
        const CHART_LOADING_MESSAGE_ID_PN = 'chart-loading-message-pn';

        const TASKS_PN = {
            READ_THEORY: 'read_theory',
            RUN_CODE: 'run_code',
            QUIZ_ATTEMPTED: 'quiz_attempted',
            QUIZ_PASSED: 'quiz_passed'
        };
        const ALL_TASK_KEYS_PN = Object.values(TASKS_PN);
        const TOTAL_TASKS_PN = ALL_TASK_KEYS_PN.length;

        const ICON_PENDING_PN = '<svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0-4.418-4.03-8-9-8S3 7.582 3 12c0 1.454.402 2.813 1.098 3.977L3 21l5.023-1.098A8.902 8.902 0 0012 21c4.97 0 9-3.582 9-9z"></path></svg>';
        const ICON_COMPLETED_PN = '<svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';
        const ICON_IN_PROGRESS_PN = '<svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V9.05a.75.75 0 011.307-.588l5.603 3.112z" clip-rule="evenodd"></path></svg>';
        const ICON_CORRECT_ANSWER_PN = '✔️';
        const ICON_INCORRECT_ANSWER_PN = '❌';
        const ICON_THUMB_UP_PN = '👍';

        const quizDataPolinomioNewton = {
            "question-1-pn": {
                correctAnswer: "Diferencias divididas finitas.",
                feedback: { // Specific feedback for INCORRECT options
                    "Series de Taylor.": "Incorrecto. Las Series de Taylor aproximan funciones cerca de un punto usando derivadas, no interpolan un conjunto de puntos dados como lo hace el Polinomio de Newton.",
                    "Mínimos cuadrados.": "Incorrecto. Mínimos cuadrados busca una curva de mejor ajuste que no necesariamente pasa por todos los puntos, mientras que la interpolación (como Newton) sí debe pasar por todos los puntos dados.",
                }
            },
            "question-2-pn": {
                correctAnswer: "Permite añadir nuevos puntos de datos y actualizar el polinomio más fácilmente.",
                feedback: {
                    "Siempre es más preciso para un mismo número de puntos.": "Incorrecto. Tanto el polinomio de Newton como el de Lagrange producen el mismo polinomio único para un conjunto dado de puntos, por lo que su precisión es idéntica.",
                    "Solo funciona para puntos equiespaciados.": "Incorrecto. El polinomio de Newton (al igual que el de Lagrange) es versátil y funciona tanto para puntos equiespaciados como para puntos no equiespaciados.",
                }
            },
            "question-3-pn": {
                // The value for correctAnswer should exactly match the 'value' attribute of the correct radio button in HTML
                correctAnswer: "La diagonal superior de la tabla de diferencias divididas (f[\\\\(x_0\\\\)], f[\\\\(x_0,x_1\\\\)], etc.).",
                feedback: {
                    "Los valores \\\\(y_i\\\\) directamente.": "Incorrecto. Si bien \\(y_0 = f[x_0]\\) es el primer coeficiente (c₀), los coeficientes subsiguientes (c₁, c₂, etc.) son las diferencias divididas de órdenes superiores, no los valores \\(y_i\\) directamente.",
                    "Las derivadas de la función en \\\\(x_0\\\\).": "Incorrecto. Si bien \\(y_0 = f[x_0]\\) es el primer coeficiente (c₀), los coeficientes subsiguientes (c₁, c₂, etc.) son las diferencias divididas de órdenes superiores, no los valores \\(y_i\\) directamente.",
                }
            }
        };
        
        let pyodide_PN = null;
        let methodChart_PN = null;
        const mainCompletionButton_PN = document.getElementById(COMPLETION_BUTTON_ID_PN);
        const quizForm_PN = document.getElementById(QUIZ_FORM_ID_PN);
        const generalQuizFeedbackDiv_PN = document.getElementById(QUIZ_FEEDBACK_ID_PN);
        const codeInput_PN = document.getElementById(CODE_INPUT_ID_PN);
        const runCodeButton_PN = document.getElementById(RUN_CODE_BUTTON_ID_PN);
        const chartCanvas_PN = document.getElementById(CHART_CANVAS_ID_PN);
        const chartLoadingMessage_PN = document.getElementById(CHART_LOADING_MESSAGE_ID_PN);

        const taskStatusIcons_PN = {
            [TASKS_PN.READ_THEORY]: document.getElementById('task-read-theory-status-pn'),
            [TASKS_PN.RUN_CODE]: document.getElementById('task-run-code-status-pn'),
            [TASKS_PN.QUIZ_ATTEMPTED]: document.getElementById('task-quiz-attempted-status-pn'),
            [TASKS_PN.QUIZ_PASSED]: document.getElementById('task-quiz-passed-status-pn'),
        };
        const overallProgressText_PN = document.getElementById('right-sidebar-progress-text-pn');
        const overallProgressBar_PN = document.getElementById('right-sidebar-progress-bar-pn');

        function getPageProgressFromStorage_PN(pKey) {
            const defaults = {
                [TASKS_PN.READ_THEORY]: false, [TASKS_PN.RUN_CODE]: false,
                [TASKS_PN.QUIZ_ATTEMPTED]: false, [TASKS_PN.QUIZ_PASSED]: false,
                overall_progress: 0, user_quiz_answers: {}, quiz_current_score: 0, quiz_feedback_active: false
            };
            try {
                const stored = localStorage.getItem(pKey);
                return stored ? { ...defaults, ...JSON.parse(stored) } : { ...defaults };
            } catch (e) { console.error("Error al leer localStorage:", e); return { ...defaults }; }
        }

        function savePageProgressToStorage_PN(pKey, progress) {
            try { localStorage.setItem(pKey, JSON.stringify(progress)); }
            catch (e) { console.error("Error al guardar en localStorage:", e); }
        }

        function updateTaskStatusInStorage_PN(taskName, isCompleted) {
            let currentProgress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
            if (currentProgress[taskName] !== isCompleted) {
                currentProgress[taskName] = isCompleted;
                if (taskName === TASKS_PN.QUIZ_ATTEMPTED && !isCompleted) {
                    currentProgress[TASKS_PN.QUIZ_PASSED] = false; currentProgress.user_quiz_answers = {}; currentProgress.quiz_current_score = 0; currentProgress.quiz_feedback_active = false;
                }
                if (taskName === TASKS_PN.QUIZ_PASSED && !isCompleted && !currentProgress[TASKS_PN.QUIZ_ATTEMPTED]) {
                     currentProgress.user_quiz_answers = {}; currentProgress.quiz_current_score = 0;
                }
                savePageProgressToStorage_PN(PAGE_KEY_PN, currentProgress);
                calculateAndUpdateOverallProgress_PN();
            }
        }

        function renderTaskStatus_PN() {
            const progress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
            ALL_TASK_KEYS_PN.forEach(taskKey => {
                const iconElement = taskStatusIcons_PN[taskKey];
                if (iconElement) {
                    let newIconHTML = ICON_PENDING_PN;
                    if (progress[taskKey]) newIconHTML = ICON_COMPLETED_PN;
                    else if (taskKey === TASKS_PN.QUIZ_PASSED && progress[TASKS_PN.QUIZ_ATTEMPTED]) newIconHTML = ICON_IN_PROGRESS_PN;
                    iconElement.innerHTML = newIconHTML;
                }
            });
        }
        
        function calculateAndUpdateOverallProgress_PN() {
            let progress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
            let completedTasks = ALL_TASK_KEYS_PN.filter(key => progress[key]).length;
            const percentage = TOTAL_TASKS_PN > 0 ? (completedTasks / TOTAL_TASKS_PN) * 100 : 0;
            progress.overall_progress = percentage;
            savePageProgressToStorage_PN(PAGE_KEY_PN, progress);

            if (overallProgressBar_PN) {
                overallProgressBar_PN.style.width = `${percentage.toFixed(0)}%`;
                overallProgressBar_PN.classList.toggle('animate-rainbow-border', percentage.toFixed(0) === '100');
            }
            if (overallProgressText_PN) overallProgressText_PN.textContent = `${percentage.toFixed(0)}%`;
            
            renderTaskStatus_PN();
            updateMainCompletionButtonState_PN();
        }

        function handleMarkAllMouseEnter_PN() {
            if (mainCompletionButton_PN && mainCompletionButton_PN.dataset.isUndo === "true") {
                mainCompletionButton_PN.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                mainCompletionButton_PN.classList.add('bg-red-600', 'hover:bg-red-700');
            }
        }

        function handleMarkAllMouseLeave_PN() {
            if (mainCompletionButton_PN && mainCompletionButton_PN.dataset.isUndo === "true") {
                mainCompletionButton_PN.classList.remove('bg-red-600', 'hover:bg-red-700');
                mainCompletionButton_PN.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
            }
        }
        
        function updateMainCompletionButtonState_PN() {
            if (!mainCompletionButton_PN) return;
            const progress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
            let allTasksCompleted = ALL_TASK_KEYS_PN.every(task => progress[task]);
            
            mainCompletionButton_PN.removeEventListener('mouseenter', handleMarkAllMouseEnter_PN);
            mainCompletionButton_PN.removeEventListener('mouseleave', handleMarkAllMouseLeave_PN);
            mainCompletionButton_PN.classList.remove('bg-green-600', 'hover:bg-green-700', 'bg-yellow-500', 'hover:bg-yellow-600', 'bg-red-600', 'hover:bg-red-700', 'opacity-50', 'cursor-not-allowed');
            mainCompletionButton_PN.disabled = false;

            if (allTasksCompleted) {
                mainCompletionButton_PN.textContent = 'Deshacer Completado';
                mainCompletionButton_PN.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
                mainCompletionButton_PN.dataset.isUndo = "true";
                mainCompletionButton_PN.addEventListener('mouseenter', handleMarkAllMouseEnter_PN);
                mainCompletionButton_PN.addEventListener('mouseleave', handleMarkAllMouseLeave_PN);
            } else {
                mainCompletionButton_PN.textContent = 'Marcar Todo Completado';
                mainCompletionButton_PN.classList.add('bg-green-600', 'hover:bg-green-700');
                mainCompletionButton_PN.dataset.isUndo = "false";
            }
        }

        function clearAllVisualFeedback_PN(clearGeneralMessage = false) {
            if (!quizForm_PN) return;
            quizForm_PN.querySelectorAll('.quiz-option-wrapper').forEach(wrapper => {
                wrapper.classList.remove('correct-answer-biseccion', 'incorrect-answer-biseccion', 'border-green-500', 'border-red-500', 'ring-1', 'ring-green-500', 'ring-red-500', 'bg-green-50', 'bg-red-50');
                wrapper.classList.add('border-gray-300', 'hover:border-gray-400', 'has-[:checked]:bg-red-50', 'has-[:checked]:border-custom-red', 'has-[:checked]:ring-1', 'has-[:checked]:ring-custom-red');
                const iconPlaceholder = wrapper.querySelector('.feedback-icon-placeholder span');
                if (iconPlaceholder) iconPlaceholder.innerHTML = '';
            });
            quizForm_PN.querySelectorAll('.specific-question-feedback').forEach(el => { el.textContent = ''; el.style.display = 'none'; });
            if (clearGeneralMessage && generalQuizFeedbackDiv_PN) {
                generalQuizFeedbackDiv_PN.textContent = ''; generalQuizFeedbackDiv_PN.style.display = 'none';
                generalQuizFeedbackDiv_PN.className = 'quiz-feedback-message mt-4 p-3 rounded-md text-sm';
            }
        }
        
function displayQuizFeedback_PN() {
            if (!quizForm_PN || !generalQuizFeedbackDiv_PN) return;
            const progress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
            const userAnswers = progress.user_quiz_answers || {};
            const submitButton = quizForm_PN.querySelector('button[type="submit"]');

            clearAllVisualFeedback_PN(false); 

            if (!progress.quiz_feedback_active && Object.keys(userAnswers).length === 0) {
                quizForm_PN.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = false);
                if (submitButton) { submitButton.textContent = 'Enviar Respuestas'; submitButton.disabled = false; }
                return;
            }
            
            let allCorrect = true; let score = 0;
            for (const questionName in quizDataPolinomioNewton) {
                const userAnswer = userAnswers[questionName];
                const questionData = quizDataPolinomioNewton[questionName];
                const correctAnswer = questionData.correctAnswer;
                const specificFeedbackDiv = document.getElementById(`${questionName}-specific-feedback`);

                quizForm_PN.querySelectorAll(`input[name="${questionName}"]`).forEach(input => {
                    const wrapper = input.closest('.quiz-option-wrapper');
                    const iconPlaceholder = wrapper.querySelector('.feedback-icon-placeholder span');
                    input.disabled = true; 
                    wrapper.classList.remove('has-[:checked]:bg-red-50', 'has-[:checked]:border-custom-red', 'has-[:checked]:ring-1', 'has-[:checked]:ring-custom-red');
                    
                    if (input.value === userAnswer) { // This is the option the user selected
                        input.checked = true;
                        if (userAnswer === correctAnswer) { // User selected THIS option, and it's CORRECT
                            wrapper.classList.add('correct-answer-biseccion', 'border-green-500', 'ring-1', 'ring-green-500', 'bg-green-50');
                            if (iconPlaceholder) iconPlaceholder.textContent = ICON_CORRECT_ANSWER_PN;
                            score++;
                            if (specificFeedbackDiv) { // Clear any previous specific feedback if now correct
                                specificFeedbackDiv.textContent = '';
                                specificFeedbackDiv.style.display = 'none';
                            }
                        } else { // User selected THIS option, and it's INCORRECT
                            wrapper.classList.add('incorrect-answer-biseccion', 'border-red-500', 'ring-1', 'ring-red-500', 'bg-red-50');
                            if (iconPlaceholder) iconPlaceholder.textContent = ICON_INCORRECT_ANSWER_PN;
                            allCorrect = false;
                            if (specificFeedbackDiv) {
                                if (questionData.feedback && questionData.feedback[userAnswer]) {
                                    specificFeedbackDiv.textContent = questionData.feedback[userAnswer]; // Show specific feedback for the chosen wrong answer
                                } else {
                                    specificFeedbackDiv.textContent = "Esta respuesta es incorrecta."; // Generic if no specific feedback
                                }
                                specificFeedbackDiv.style.display = 'block';
                            }
                        }
                    } else if (input.value === correctAnswer) { // This option was NOT selected by user, BUT IT IS THE CORRECT ONE
                         wrapper.classList.add('correct-answer-biseccion', 'border-green-500', 'bg-green-50'); // Highlight correct answer
                         // Show thumbs up only if the user actually got this question wrong (i.e., userAnswer is not correctAnswer)
                         if (userAnswer !== correctAnswer && iconPlaceholder) {
                            iconPlaceholder.textContent = ICON_THUMB_UP_PN;
                         }
                    } else { // This option was NOT selected, AND IT IS NOT THE CORRECT ONE
                         wrapper.classList.add('border-gray-300'); // Default border for other non-selected, non-correct options
                    }
                });
            }

            progress.quiz_current_score = score; savePageProgressToStorage_PN(PAGE_KEY_PN, progress);
            generalQuizFeedbackDiv_PN.style.display = 'block';
            if (allCorrect) {
                generalQuizFeedbackDiv_PN.className = 'mt-4 p-3 rounded-md text-sm bg-green-100 text-green-700 border border-green-200';
                generalQuizFeedbackDiv_PN.innerHTML = `<strong>¡Felicidades!</strong> Todas tus respuestas son correctas. (${score}/${Object.keys(quizDataPolinomioNewton).length})`;
                if (submitButton) { submitButton.textContent = 'Cuestionario Aprobado'; submitButton.disabled = true; }
                updateTaskStatusInStorage_PN(TASKS_PN.QUIZ_PASSED, true);
            } else {
                generalQuizFeedbackDiv_PN.className = 'mt-4 p-3 rounded-md text-sm bg-red-100 text-red-700 border border-red-200';
                generalQuizFeedbackDiv_PN.innerHTML = `Has respondido correctamente ${score} de ${Object.keys(quizDataPolinomioNewton).length} preguntas. Revisa los comentarios e intenta de nuevo.`;
                if (submitButton) { submitButton.textContent = 'Intentar de Nuevo'; submitButton.disabled = false; }
                 updateTaskStatusInStorage_PN(TASKS_PN.QUIZ_PASSED, false);
            }
            if (window.MathJax && window.MathJax.typesetPromise && quizForm_PN) {
                window.MathJax.typesetPromise([quizForm_PN]).catch(err => console.error('Error MathJax en quiz PN:', err));
            }
        }

        async function initializePyodide_PN() {
            if (!window.pyodideInstance_PN_Global) {
                if (codeOutput_PN) codeOutput_PN.innerHTML = "<p>Cargando Pyodide (PN)...</p>";
                try {
                    console.log("[PN] Iniciando carga de Pyodide...");
                    window.pyodideInstance_PN_Global = await window.loadPyodide();
                    console.log("[PN] Pyodide cargado. Cargando paquetes (numpy)...");
                    await window.pyodideInstance_PN_Global.loadPackage(["numpy", "micropip"]);
                    console.log("[PN] Paquetes cargados. Configurando globales...");
                    window.pyodideInstance_PN_Global.globals.set("js_iteration_data_pn", window.pyodideInstance_PN_Global.toPy([])); // List to store dicts
                    window.pyodideInstance_PN_Global.globals.set("pyodide_html_output_pn", "");
                    if (codeOutput_PN) codeOutput_PN.innerHTML = "<p>Pyodide (PN) listo. Presiona 'Ejecutar Código'.</p>";
                    if (runCodeButton_PN) runCodeButton_PN.disabled = false;
                } catch (error) {
                    console.error("[PN] Error al cargar/configurar Pyodide:", error);
                    if (codeOutput_PN) codeOutput_PN.innerHTML = `<p style="color:red;">Error Pyodide (PN): ${error.message}</p>`;
                    if (runCodeButton_PN) runCodeButton_PN.disabled = true;
                    window.pyodideInstance_PN_Global = null; return null;
                }
            } else {
                 console.log("[PN] Pyodide ya cargado (window.pyodideInstance_PN_Global).");
                 if (runCodeButton_PN) runCodeButton_PN.disabled = false;
            }
            return window.pyodideInstance_PN_Global;
        }

        async function runCodeNow_PN() {
            pyodide_PN = await initializePyodide_PN();
            if (!pyodide_PN || !codeInput_PN || !codeOutput_PN) return;

            const pythonCode = codeInput_PN.value;
            if (codeOutput_PN) codeOutput_PN.innerHTML = "<p>Ejecutando código (PN)...</p>";
            if (chartLoadingMessage_PN) chartLoadingMessage_PN.textContent = "Generando datos para la gráfica (PN)...";
            if (chartCanvas_PN) chartCanvas_PN.style.display = 'none';

            try {
                pyodide_PN.globals.set("pyodide_html_output_pn", "");
                pyodide_PN.runPython("if 'js_iteration_data_pn' in globals(): js_iteration_data_pn.clear()");
                pyodide_PN.setStdout({}); pyodide_PN.setStderr({});
                
                await pyodide_PN.loadPackagesFromImports(pythonCode); // Ensure numpy is loaded if not explicitly by loadPackage
                await pyodide_PN.runPythonAsync(pythonCode);
                
                const htmlResult = pyodide_PN.globals.get("pyodide_html_output_pn");
                if (codeOutput_PN) codeOutput_PN.innerHTML = htmlResult || "<p>Ejecución (PN) completada. Sin salida HTML.</p>";
                
                const iterationDataListJS_PN = pyodide_PN.globals.get("js_iteration_data_pn").toJs({ dict_converter: Object.fromEntries });
                // iterationDataListJS_PN should be a list containing one dictionary with graph data
                const graphData = (iterationDataListJS_PN && iterationDataListJS_PN.length > 0) ? iterationDataListJS_PN[0] : null;


                updateTaskStatusInStorage_PN(TASKS_PN.RUN_CODE, true);

                if (chartCanvas_PN) {
                    if (graphData) {
                        await drawChartJsGraph_PN(graphData);
                        if (chartLoadingMessage_PN) chartLoadingMessage_PN.style.display = 'none';
                        chartCanvas_PN.style.display = 'block';
                    } else {
                        if (chartLoadingMessage_PN) {
                             chartLoadingMessage_PN.textContent = "No se generaron datos suficientes para la gráfica (PN).";
                             chartLoadingMessage_PN.style.display = 'block';
                        }
                        if (methodChart_PN && typeof methodChart_PN.destroy === 'function') methodChart_PN.destroy();
                    }
                }
            } catch (error) { 
                if (codeOutput_PN) codeOutput_PN.innerHTML = `<p style="color:red;">Error ejecución (PN): ${error.message || String(error)}</p>`;
                if (chartLoadingMessage_PN) chartLoadingMessage_PN.textContent = "Error al generar datos para gráfica (PN).";
                console.error("Error en runCodeNow_PN:", error);
            } finally {
                pyodide_PN.setStdout({}); pyodide_PN.setStderr({});
            }
        }

        // JavaScript equivalent of newton_polynomial_evaluation for graph plotting
        function evalNewtonPolynomialJS(x_nodes, coeffs, x_val) {
            let result = coeffs[0];
            let term_product = 1.0;
            for (let i = 1; i < coeffs.length; i++) {
                term_product *= (x_val - x_nodes[i-1]);
                result += coeffs[i] * term_product;
            }
            return result;
        }

        async function drawChartJsGraph_PN(graphData) {
            if (!chartCanvas_PN) { console.error("Canvas (PN) no encontrado."); return; }
            if (!graphData || !graphData.x_nodes || !graphData.y_nodes || !graphData.coeffs) {
                 if(chartLoadingMessage_PN) chartLoadingMessage_PN.textContent = 'Datos insuficientes para gráfica (PN).';
                 return;
            }
            if(chartLoadingMessage_PN) chartLoadingMessage_PN.textContent = 'Generando gráfica (PN)...';

            const { x_nodes, y_nodes, coeffs, x_interpolated, y_interpolated } = graphData;

            // Generate points for the polynomial curve
            const x_min_plot = Math.min(...x_nodes) - 1;
            const x_max_plot = Math.max(...x_nodes) + 1;
            const num_points_poly = 200;
            const x_poly_vals = Array.from({length: num_points_poly}, (_, i) => x_min_plot + i * (x_max_plot - x_min_plot) / (num_points_poly - 1));
            const y_poly_vals = x_poly_vals.map(x => evalNewtonPolynomialJS(x_nodes, coeffs, x));

            const datasets_pn = [];
            // Original data points
            datasets_pn.push({
                label: 'Puntos Originales (x_i, y_i)',
                data: x_nodes.map((val, index) => ({x: val, y: y_nodes[index]})),
                backgroundColor: 'rgb(255, 99, 132)', // Red
                pointRadius: 6,
                type: 'scatter',
                order: 2
            });
            // Newton polynomial curve
            datasets_pn.push({
                label: 'Polinomio de Newton P(x)',
                data: x_poly_vals.map((val, index) => ({x: val, y: y_poly_vals[index]})),
                borderColor: 'rgb(54, 162, 235)', // Blue
                borderWidth: 2,
                fill: false,
                tension: 0.1,
                type: 'line',
                pointRadius: 0,
                order: 1
            });
            // Interpolated point (if available)
            if (typeof x_interpolated === 'number' && typeof y_interpolated === 'number') {
                datasets_pn.push({
                    label: `Punto Interpolado (${x_interpolated.toFixed(2)}, ${y_interpolated.toFixed(4)})`,
                    data: [{x: x_interpolated, y: y_interpolated}],
                    backgroundColor: 'rgb(75, 192, 75)', // Green
                    pointRadius: 8,
                    pointStyle: 'star',
                    type: 'scatter',
                    order: 3
                });
            }
            
            if (methodChart_PN && typeof methodChart_PN.destroy === 'function') {
                methodChart_PN.destroy();
            }
            const ctx_pn = chartCanvas_PN.getContext('2d');
            methodChart_PN = new Chart(ctx_pn, {
                type: 'scatter', // Base type, specific types per dataset
                data: { datasets: datasets_pn },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { 
                        x: { title: { display: true, text: 'x' } }, 
                        y: { title: { display: true, text: 'y = P(x)' } } 
                    },
                    plugins: { 
                        legend: { position: 'top' }, 
                        title: { display: true, text: "Polinomio de Interpolación de Newton", font: {size: 16} },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    label += `(x: ${context.parsed.x.toFixed(4)}, y: ${context.parsed.y.toFixed(4)})`;
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            if(chartLoadingMessage_PN) chartLoadingMessage_PN.style.display = 'none';
        }
        
        // --- Event Listeners y Lógica de Inicialización ---
        if (runCodeButton_PN) runCodeButton_PN.addEventListener('click', runCodeNow_PN);
        if (quizForm_PN) {
            quizForm_PN.addEventListener('submit', function(event) {
                event.preventDefault();
                const currentLocalProgress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
                const submitButton = quizForm_PN.querySelector('button[type="submit"]');

                if (currentLocalProgress[TASKS_PN.QUIZ_PASSED] && submitButton.textContent !== 'Intentar de Nuevo') return;

                if (submitButton && submitButton.textContent === 'Intentar de Nuevo') {
                    quizForm_PN.reset(); clearAllVisualFeedback_PN(true); 
                    if(generalQuizFeedbackDiv_PN) generalQuizFeedbackDiv_PN.style.display = 'none';
                    let progressToSave = getPageProgressFromStorage_PN(PAGE_KEY_PN);
                    progressToSave.user_quiz_answers = {}; progressToSave.quiz_current_score = 0; progressToSave.quiz_feedback_active = false; 
                    savePageProgressToStorage_PN(PAGE_KEY_PN, progressToSave);
                    updateTaskStatusInStorage_PN(TASKS_PN.QUIZ_PASSED, false); 
                    quizForm_PN.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = false);
                    quizForm_PN.querySelectorAll('.quiz-option-wrapper').forEach(wrapper => {
                         wrapper.classList.add('has-[:checked]:bg-red-50', 'has-[:checked]:border-custom-red', 'has-[:checked]:ring-1', 'has-[:checked]:ring-custom-red');
                    });
                    submitButton.textContent = 'Enviar Respuestas'; return;
                }

                const formData = new FormData(quizForm_PN);
                let allAnswered = Object.keys(quizDataPolinomioNewton).every(qName => formData.get(qName) !== null);

                if (!allAnswered) {
                    if (generalQuizFeedbackDiv_PN) {
                        generalQuizFeedbackDiv_PN.textContent = "Por favor, responde todas las preguntas.";
                        generalQuizFeedbackDiv_PN.className = 'mt-4 p-3 rounded-md text-sm bg-yellow-100 text-yellow-700 border border-yellow-200';
                        generalQuizFeedbackDiv_PN.style.display = 'block';
                    } return;
                }
                
                updateTaskStatusInStorage_PN(TASKS_PN.QUIZ_ATTEMPTED, true);
                let progress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
                progress.user_quiz_answers = {};
                for (const questionName of Object.keys(quizDataPolinomioNewton)) {
                    progress.user_quiz_answers[questionName] = formData.get(questionName);
                }
                progress.quiz_feedback_active = true; 
                savePageProgressToStorage_PN(PAGE_KEY_PN, progress);
                displayQuizFeedback_PN();
            });
        }
        if (mainCompletionButton_PN) {
            mainCompletionButton_PN.addEventListener('click', () => {
                const progress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
                let markAllAs = !ALL_TASK_KEYS_PN.every(key => progress[key]);
                ALL_TASK_KEYS_PN.forEach(taskName => updateTaskStatusInStorage_PN(taskName, markAllAs));
                let updatedProgress = getPageProgressFromStorage_PN(PAGE_KEY_PN);
                if (!markAllAs) {
                    updatedProgress.user_quiz_answers = {}; updatedProgress.quiz_current_score = 0; updatedProgress.quiz_feedback_active = false;
                    if (quizForm_PN) {
                        quizForm_PN.reset(); quizForm_PN.querySelectorAll('input[type="radio"]').forEach(r => r.disabled = false);
                        const sb = quizForm_PN.querySelector('button[type="submit"]'); if(sb) sb.textContent = 'Enviar Respuestas';
                        quizForm_PN.querySelectorAll('.quiz-option-wrapper').forEach(w => w.classList.add('has-[:checked]:bg-red-50', 'has-[:checked]:border-custom-red', 'has-[:checked]:ring-1', 'has-[:checked]:ring-custom-red'));
                    }
                    clearAllVisualFeedback_PN(true);
                } else {
                     updatedProgress[TASKS_PN.QUIZ_ATTEMPTED] = true; updatedProgress[TASKS_PN.QUIZ_PASSED] = true;
                    if (Object.keys(updatedProgress.user_quiz_answers).length === 0) {
                        for (const qN in quizDataPolinomioNewton) updatedProgress.user_quiz_answers[qN] = quizDataPolinomioNewton[qN].correctAnswer;
                        updatedProgress.quiz_current_score = Object.keys(quizDataPolinomioNewton).length;
                    }
                    updatedProgress.quiz_feedback_active = true;
                }
                savePageProgressToStorage_PN(PAGE_KEY_PN, updatedProgress);
                if (quizForm_PN) displayQuizFeedback_PN();
                calculateAndUpdateOverallProgress_PN();
                if (generalQuizFeedbackDiv_PN && !markAllAs) generalQuizFeedbackDiv_PN.style.display = 'none';
                alert(markAllAs ? 'Tareas completadas.' : 'Completado deshecho.');
            });
        }

        const theorySectionObserverTargetNode_PN = document.getElementById('conclusion-metodo') || document.getElementById('teoria');
        if (theorySectionObserverTargetNode_PN) {
            const observer_PN = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !getPageProgressFromStorage_PN(PAGE_KEY_PN)[TASKS_PN.READ_THEORY]) {
                        updateTaskStatusInStorage_PN(TASKS_PN.READ_THEORY, true);
                    }
                });
            }, { threshold: 0.1 });
            observer_PN.observe(theorySectionObserverTargetNode_PN);
        }
        
        if (window.location.hash) history.replaceState(null, '', window.location.pathname + window.location.search);
        
        (async () => { 
            pyodide_PN = await initializePyodide_PN();
            if (pyodide_PN && chartCanvas_PN && chartLoadingMessage_PN) {
                chartLoadingMessage_PN.textContent = "Ejecute el código para generar los datos de la gráfica.";
            }
            if (pyodide_PN && runCodeButton_PN) runCodeButton_PN.disabled = false;
            else if (runCodeButton_PN) runCodeButton_PN.disabled = true;
        })();

        const initialProgress_PN = getPageProgressFromStorage_PN(PAGE_KEY_PN);
        if (initialProgress_PN.quiz_feedback_active || (initialProgress_PN[TASKS_PN.QUIZ_ATTEMPTED] && Object.keys(initialProgress_PN.user_quiz_answers).length > 0) ) {
            if (quizForm_PN && initialProgress_PN.user_quiz_answers) {
                 for (const qName in initialProgress_PN.user_quiz_answers) {
                    const userAnswer = initialProgress_PN.user_quiz_answers[qName];
                    const escapedUserAnswer = userAnswer.replace(/([\\()\[\]"'])/g, '\\$1');
                    try {
                        const radioToSelect = quizForm_PN.querySelector(`input[name="${qName}"][value="${escapedUserAnswer}"]`);
                        if (radioToSelect) radioToSelect.checked = true;
                    } catch (e) { console.warn(`Error seleccionando radio PN ${qName}:`, e); }
                }
            }
            displayQuizFeedback_PN(); 
        } else if (quizForm_PN) {
            const sb = quizForm_PN.querySelector('button[type="submit"]'); if(sb) {sb.textContent = 'Enviar Respuestas'; sb.disabled = false;}
            quizForm_PN.querySelectorAll('input[type="radio"]').forEach(r => r.disabled = false);
            quizForm_PN.querySelectorAll('.quiz-option-wrapper').forEach(w => w.classList.add('has-[:checked]:bg-red-50', 'has-[:checked]:border-custom-red', 'has-[:checked]:ring-1', 'has-[:checked]:ring-custom-red'));
            if (window.MathJax && window.MathJax.typesetPromise && quizForm_PN) {
                window.MathJax.typesetPromise([quizForm_PN]).catch(err => console.error('Error MathJax carga inicial PN:', err));
            }
        }
        calculateAndUpdateOverallProgress_PN();
    });
    </script>
    <!-- END PN SCRIPT -->

<script type="module">
    const { createApp, ref, onMounted, onUnmounted, watch, nextTick } = Vue;

    const LeftSidebar = { // Definición del componente LeftSidebar para Vue
        props: {
            pageThemeColor: { type: String, default: 'red' }, // Color base del tema (e.g., 'red', 'blue')
            pageGradientFrom: { type: String, default: 'from-red-500' }, // Clase para inicio de gradiente
            pageGradientTo: { type: String, default: 'to-red-700' },     // Clase para fin de gradiente
            pageActiveTextColor: { type: String, default: 'text-custom-red' } // Texto activo para links, usa el color base
        },
        template: `{% raw %}
            <aside 
                :class="[
                    'bg-gradient-to-b', pageGradientFrom, pageGradientTo,
                    'shadow-xl', 'rounded-lg', 'p-4',
                    'flex', 'flex-col',
                    'transition-all', 'duration-300', 'ease-in-out',
                    'order-1', 
                    isCollapsed ? 'w-full lg:w-20' : 'w-full lg:w-64',
                    'self-start', 
                    'lg:sticky', 'lg:top-8', 
                    'lg:max-h-[calc(100vh-4rem)]', // Altura máxima considerando 2rem (top-8) * 2 para arriba y abajo
                    'overflow-y-auto' // Scroll si el contenido excede la altura máxima
                ]"
                aria-label="Sidebar de navegación del método">
                <div :class="['flex justify-between items-center mb-4 border-b pb-3', 'border-' + pageThemeColor + '-400']">
                    <h3 v-show="!isCollapsed" class="text-lg font-semibold text-white select-none">Contenido</h3>
                    <button @click="toggleCollapse" :class="['p-1.5 ml-2 text-white rounded focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-75', 'hover:bg-' + pageThemeColor + '-600']" :aria-label="isCollapsed ? 'Expandir menú' : 'Colapsar menú'">
                        <svg v-if="!isCollapsed" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M18.75 19.5l-7.5-7.5 7.5-7.5m-6 15L5.25 12l7.5-7.5" />
                        </svg>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 4.5l7.5 7.5-7.5 7.5m-6-15l7.5 7.5-7.5 7.5" />
                        </svg>
                    </button>
                </div>
                <nav v-show="!isCollapsed" class="flex-grow">
                    <ul class="space-y-1">
                        <li v-for="item in navItems" :key="item.id">
                            <a :href="item.href"
                               @click.prevent="smoothScroll(item.href)"
                               :class="[
                                   'nav-link block px-4 py-2 rounded-md text-sm font-medium transition-colors duration-150 flex items-center',
                                   isActive(item.id) ? ['bg-white shadow-sm font-semibold', pageActiveTextColor] : ['text-' + pageThemeColor + '-100', 'hover:text-white', 'hover:bg-' + pageThemeColor + '-600']
                               ]">
                                <span v-html="item.iconSVG" class="mr-3 translate-y-px"></span>
                                <span>{{ item.text }}</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <nav v-show="isCollapsed" class="mt-4 flex-grow">
                     <ul class="space-y-1">
                        <li v-for="item in navItems" :key="item.id + '-collapsed'">
                            <a :href="item.href"
                               @click.prevent="smoothScroll(item.href)"
                               :title="item.text"
                               :aria-label="item.text"
                               :class="[
                                   'nav-link-collapsed block py-2 pl-2.5 pr-1.5 rounded-md transition-colors duration-150 flex justify-center items-center',
                                   isActive(item.id) ? ['bg-white shadow-sm', pageActiveTextColor] : ['text-' + pageThemeColor + '-100', 'hover:text-white', 'hover:bg-' + pageThemeColor + '-600']
                               ]">
                                <span v-html="item.iconSVG" class="w-6 h-6 translate-y-px"></span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </aside>
        {% endraw %}`,
        setup(props) {
            const isCollapsed = ref(false);
            const activeSectionId = ref(null);
            // navItems se define aquí o se pasa como prop si varía mucho entre páginas
            const navItems = ref([
                { id: 'teoria', text: 'Fundamento Teórico', href: '#teoria', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>' },
                { id: 'algoritmo', text: 'Pasos del Algoritmo', href: '#algoritmo', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" /></svg>' },
                { id: 'ejemplo', text: 'Ejemplo Detallado', href: '#ejemplo', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>' },
                { id: 'codigo', text: 'Implementación (Python)', href: '#codigo', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z" /></svg>' },
                { id: 'graficas', text: 'Gráficas Interactivas', href: '#graficas', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" /></svg>' },
                { id: 'videos', text: 'Videos Explicativos', href: '#videos', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.75.75 0 010 1.656l-5.603 3.113A.75.75 0 019 15.95V9.05a.75.75 0 011.307-.588l5.603 3.112z" /></svg>' },
                { id: 'conclusion-metodo', text: 'Conclusión y Aplicaciones', href: '#conclusion-metodo', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" /></svg>' },
                { id: 'referencias', text: 'Referencias', href: '#referencias', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 3.75V16.5L12 14.25L7.5 16.5V3.75m9 0H18A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6A2.25 2.25 0 016 3.75h1.5m9 0h-9" /></svg>' },
                { id: 'cuestionario', text: 'Cuestionario', href: '#cuestionario', iconSVG: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" /></svg>' }
            ]); // Asegúrate de que estos navItems sean los correctos para todas las páginas o ajústalos.

            let sections = []; // Para el scroll-spy

            const toggleCollapse = () => {
                isCollapsed.value = !isCollapsed.value;
            };

            const isActive = (id) => {
                return activeSectionId.value === id;
            };
            
            const smoothScroll = (targetHref) => {
                const targetId = targetHref.substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: "smooth", block: "start" });
                    history.pushState(null, null, targetHref); 
                }
            };

            const handleScroll = () => {
                if (!sections || sections.length === 0) return;
                const scrollMarginTopValue = parseInt(getComputedStyle(sections[0]).scrollMarginTop) || 96; 
                let newActiveSectionId = null;
                for (let i = 0; i < sections.length; i++) {
                    const section = sections[i];
                    const sectionTopBoundary = section.offsetTop - scrollMarginTopValue;
                    const sectionBottomBoundary = sectionTopBoundary + section.offsetHeight;
                    if (window.scrollY >= sectionTopBoundary && window.scrollY < sectionBottomBoundary) {
                        newActiveSectionId = section.id;
                        break;
                    }
                }
                if (newActiveSectionId === null && sections.length > 0) {
                    for (let i = sections.length - 1; i >= 0; i--) {
                        const section = sections[i];
                        if ((section.offsetTop - scrollMarginTopValue) <= window.scrollY + 5) {
                            newActiveSectionId = section.id;
                            break;
                        }
                    }
                }
                 if (newActiveSectionId === null && sections.length > 0 && window.scrollY < (sections[0].offsetTop - scrollMarginTopValue)) {
                    newActiveSectionId = sections[0].id;
                 }
                if (activeSectionId.value !== newActiveSectionId) {
                    activeSectionId.value = newActiveSectionId;
                }
            };

            onMounted(() => {
                nextTick(() => {
                    sections = Array.from(document.querySelectorAll('main article section[id]'));
                    handleScroll(); 
                    window.addEventListener('scroll', handleScroll, { passive: true });
                });
            });

            onUnmounted(() => {
                window.removeEventListener('scroll', handleScroll);
            });

            return {
                isCollapsed,
                toggleCollapse,
                navItems,
                isActive,
                smoothScroll,
                activeSectionId,
                // pageThemeColor, pageGradientFrom, pageGradientTo, pageActiveTextColor // Expuestas desde props
            };
        }
    };

    const app = createApp({
        components: { LeftSidebar },
        setup() {
            const METHOD_KEY_PN_VUE = "polinomio-newton";
            const METHOD_NAME_PN_VUE = "Polinomio de Newton";
            // Other Vue-specific logic for the main app could go here if needed
            onMounted(() => {
                if (window.MathJax && window.MathJax.typesetPromise) {
                    nextTick(() => window.MathJax.typesetPromise());
                }
            });
            return { methodKeyProps: METHOD_KEY_PN_VUE, methodNameProps: METHOD_NAME_PN_VUE };
        }
    });
    app.config.compilerOptions.isCustomElement = tag => tag.startsWith('mjx-');
    app.mount('#app');
</script>
</body>
</html>